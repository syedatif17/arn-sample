âœ… STEP 1 â€” Disable and stop all Arc services

Run:

sudo systemctl stop himdsd arcproxyd extd gcad
sudo systemctl disable himdsd arcproxyd extd gcad


If any service shows â€œnot foundâ€ â†’ that is okay.

âœ… STEP 2 â€” Remove service files from ALL correct folders

Run these EXACT commands (they are safe):

sudo rm -f /usr/lib/systemd/system/himdsd.service
sudo rm -f /usr/lib/systemd/system/arcproxyd.service
sudo rm -f /usr/lib/systemd/system/extd.service
sudo rm -f /usr/lib/systemd/system/gcad.service

sudo rm -f /etc/systemd/system/multi-user.target.wants/himdsd.service
sudo rm -f /etc/systemd/system/multi-user.target.wants/arcproxyd.service
sudo rm -f /etc/systemd/system/multi-user.target.wants/extd.service
sudo rm -f /etc/systemd/system/multi-user.target.wants/gcad.service

âœ… STEP 3 â€” Reload systemd
sudo systemctl daemon-reload

â— STEP 4 â€” Remove old identities + certificates

This is the MOST important part. Otherwise it will always remain Disconnected.

Run:

sudo rm -rf /var/opt/azcmagent
sudo rm -rf /opt/azcmagent
sudo rm -rf /etc/opt/azcmagent

â— STEP 5 â€” Confirm everything is CLEAN

Run:

sudo find / -name "azcmagent" 2>/dev/null


The ONLY valid result should be:

(no output)


If you still see /opt/azcmagent/bin/azcmagent, delete it:

sudo rm -rf /opt/azcmagent

ðŸ”¥ STEP 6 â€” Now perform a CLEAN reinstall

Run the official installer:

cd /root
curl -o install.sh -L https://aka.ms/azcmagent
sudo bash install.sh


This will reinstall:

âœ” himdsd
âœ” extd
âœ” arcproxyd
âœ” gcad
âœ” azcmagent binary

âœ… STEP 7 â€” Verify services
systemctl status himdsd arcproxyd extd gcad


EXPECTED:

himdsd â†’ running

arcproxyd â†’ running

extd â†’ running

gcad â†’ running

ðŸŸ¢ STEP 8 â€” Verify Arc connection
azcmagent show
azcmagent show status


This time it will NOT freeze.

ðŸ“Œ WHY THIS HAPPENED

You had:

Old identity files

Old certificates

Services partially removed

Systemd not fully cleaned

Multiple installs on top of each other

This ALWAYS causes Disconnected state + hanging CLI.

A full purge â†’ reinstall fixes it 100%.

ðŸ‘ Do this:

Send me the output of:

sudo find / -name "azcmagent" 2>/dev/null
